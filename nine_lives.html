<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>The Nine Lives Spread</title>
  
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #fdf6e3;
      color: #333;
      text-align: center;
      padding-top: 30px;
    }

      h1 {
      margin-bottom: 20px;
    }

    .row {
      display: flex;
      justify-content: center;
      gap: 15px;
    }

     .card-block {
      width: 220px;
    }

    .card-block img {
      width: 100%;
      height: auto;
      border-radius: 8px;
      border: 2px solid #444;
      margin-bottom: 8px;
    }

    .card-block h4 {
      font-size: 0.9em;
      margin: 6px 0;
      color: #444;
    }

     .analysis {
      font-size: 0.85em;
      color: #555;
      text-align: left;
    }

    .final-reading {
      margin-top: 40px;
      padding: 20px;
      border-top: 2px solid #444;
      font-size: 1em;
      color: #333;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
 </style>
</head>
  
<body>
  
  <h1>The Nine Lives Spread</h1>
  <p>This spread uses 9 cards to represent a stage of growth, renewal, or transformation..</p>

<div class="row row-top"></div>
<div class="row row-middle"></div>
<div class="row row-bottom"></div>

<div id="final-analysis" class="final-reading"></div>

<script>
/* ---------------- SAFETY ---------------- */

const params = new URLSearchParams(window.location.search);
let cards = [];

try {
  cards = JSON.parse(params.get("cards")) || [];
} catch (e) {
  console.error("Invalid cards parameter");
}

/* ---------------- HELPERS ---------------- */

function randomFrom(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function getCardNumber(path) {
  const match = path.match(/(\d+)\.png$/);
  return match ? parseInt(match[1], 10) : null;
}

/* ---------------- POSITION LABELS ---------------- */

const nineLivesPositions = [
  "What you have already survived",
  "A lesson that shaped your resilience",
  "A past ending that transformed you",
  "A strength you are rediscovering",

  "Your current state of renewal",
  "A challenge testing your adaptability",
  "A lesson still unfolding",

  "A future rebirth or awakening",
  "The wisdom you are growing into"
];

/* ---------------- MESSAGE ENGINE ---------------- */

function generateTarotMessage(card) {
  if (!card) {
    return "This card reflects a quiet but meaningful influence in your journey.";
  }

  const openings = [
    "At this stage of your journey,",
    "This moment reveals that",
    "Here, the energy points toward",
    "Your path is shaped by"
  ];

  const closings = [
    "Sit with this insight as it unfolds.",
    "Allow this lesson to guide you forward.",
    "Notice how this message resonates.",
    "Trust what this card is showing you."
  ];

  return `${randomFrom(openings)} ${card.light}. 
  The archetype of ${card.archetype} is active here. ${randomFrom(closings)}`;
}

/* ---------------- FINAL SYNTHESIS ---------------- */

function generateFinalNineLivesReading(entries) {
  if (!entries.length) {
    return "This spread invites reflection on resilience, renewal, and growth.";
  }

  const archetypes = entries.map(e => e.card?.archetype).filter(Boolean);
  const lights = entries.map(e => e.card?.light).filter(Boolean);

  return `
This Nine Lives reading reflects a journey shaped by survival and renewal.
Lessons of ${archetypes.slice(0,4).join(", ")} have strengthened your resilience.
You now stand in a phase of transformation, integrating past wisdom with present awareness.
What unfolds next is a rebirth — guided by clarity, growth, and inner truth.
`;
}

/* ---------------- RENDER ---------------- */

const topRow = document.querySelector(".row-top");
const middleRow = document.querySelector(".row-middle");
const bottomRow = document.querySelector(".row-bottom");

const collected = [];

cards.slice(0, 9).forEach((cardPath, index) => {
  const num = getCardNumber(cardPath);
  const data = tarotAnalysis[num]; // ← now safe
  const message = generateTarotMessage(data);

  const block = document.createElement("div");
  block.className = "card-block";

  block.innerHTML = `
    <img src="${cardPath}" alt="Tarot Card">
    <h4>${nineLivesPositions[index]}</h4>
    <p class="analysis">${message}</p>
  `;

  collected.push({ card: data });

  if (index < 4) topRow.appendChild(block);
  else if (index < 7) middleRow.appendChild(block);
  else bottomRow.appendChild(block);
});

/* ---------------- FINAL OUTPUT ---------------- */

document.getElementById("final-analysis").innerHTML =
  generateFinalNineLivesReading(collected);
</script>

</body>
</html>
 
